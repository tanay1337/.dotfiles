#!/bin/bash

export DISPLAY=:0
export DBUS_SESSION_BUS_ADDRESS="unix:path=/run/user/1000/bus"

BAT_LEVEL=$(cat /sys/class/power_supply/BAT1/capacity)
STATUS=$(cat /sys/class/power_supply/BAT1/status)

CRITICAL_NOTIFICATION=/tmp/critical_notification
NORMAL_NOTIFICATION=/tmp/normal_notification

if [ $STATUS = 'Charging' ]; then
  rm $CRITICAL_NOTIFICATION
  rm $NORMAL_NOTIFICATION
fi

if [ $STATUS = 'Discharging' ]; then
  if [ $BAT_LEVEL -lt 10 ] && [ ! -f $CRITICAL_NOTIFICATION ]; then
    notify-send -u critical "Battery Low" "Your laptop will shut down soon. Please either charge your laptop or hibernate."
    touch $CRITICAL_NOTIFICATION
  elif [ $BAT_LEVEL -lt 20 ] && [ ! -f $NORMAL_NOTIFICATION ]; then
    notify-send -u critical "Battery Low" "Please charge your laptop now."
    touch $NORMAL_NOTIFICATION
  fi
fi
