#!/usr/bin/bash

case $HOSTNAME in
  (thinkpad) BAT_DEVICE=BAT0;;
  (framework) BAT_DEVICE=BAT1;;
esac

BAT_LEVEL=$(cat /sys/class/power_supply/$BAT_DEVICE/capacity)
STATUS=$(cat /sys/class/power_supply/$BAT_DEVICE/status)

if [ $STATUS = 'Discharging' ] && [ $BAT_LEVEL -lt 8 ]; then
  systemctl hibernate
fi
